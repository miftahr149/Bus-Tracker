{% extends 'project_dummy/main.html' %} 
{% csrf_token %}
{% load static %} 
{% block content %}

<link rel="stylesheet" href="{% static 'css/common.css' %}"> 
<link rel="stylesheet" href="{% static 'css/maps.css' %}"> 
<script src="https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.js"></script>
<link
  href="https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.css"
  rel="stylesheet"
/>

<style>
  main {
    min-height: 100vh;
  }
</style>

<h1></h1>

<main class="flex-box flex-box--vertical">
  <div id="map" style="flex-grow: 1"></div>
</main>

<script>
  
</script>

<script>
  const mapbox_access_token = "{{mapbox_access_token}}";
  mapboxgl.accessToken = mapbox_access_token;

  const testFunction = (UserFunction) => {
    return fetch("{% url 'api_address' %}")
      .then(response => response.json())
      .then(UserFunction)
  }

  const createPointGeoJson = (AddressData) => {
    let [lat, long] = Object.values(AddressData.latlng)
    
    return {
      type: 'Feature',
      geometry: {
        type: 'Point',
        coordinates: [long, lat]
      },
      property: {
        title: AddressData.name
      }
    }
  }

  const mainFunction = (data) => {
    console.log(data['Arked Cengal']);
    let [start_lat, start_long] = Object.values(data['Center Point UTM (CP)']);

    let map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/mapbox/light-v11',
      center: [start_long, start_lat],
      zoom: 18
    })
  }

  testFunction(mainFunction)

</script>

{% endblock %}
